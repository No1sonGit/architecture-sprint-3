@startuml
left to right direction

actor User as "Пользователь"

package "Микросервисы" {
  component DeviceManagementService as DMS {
    note right
      Управление устройствами:
      - Включение/выключение
      - Обновление состояния
      Технологии: Java, Spring Boot
    end note
  }
  component NotificationService as NS {
    note right
      Уведомления:
      - Отправка уведомлений
      Технологии: Node.js, RabbitMQ
    end note
  }
  component AutomationService as AS {
    note right
      Автоматизация:
      - Настройка сценариев
      Технологии: Python, Flask
    end note
  }
}

package "Базы данных" {
  database DeviceManagementDB as DMDB {
    note right
      СУБД: PostgreSQL
    end note
  }
  database NotificationDB as NDB {
    note right
      СУБД: MongoDB
    end note
  }
  database AutomationDB as ADB {
    note right
      СУБД: MySQL
    end note
  }
}

queue Kafka as "Kafka"

User --> AS : "Создание/редактирование сценариев (REST)"
User --> DMS : "Управление устройствами (REST)"
DMS --> AS : "Запросы на выполнение сценариев"
AS --> Kafka : "События автоматизации"
DMS --> Kafka : "События изменения состояния устройств"
Kafka --> NS : "События для уведомлений"
NS --> NDB : "Запись уведомлений"
NS --> User : "Отправка уведомлений"

@enduml
